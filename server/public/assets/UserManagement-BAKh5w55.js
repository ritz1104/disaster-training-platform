import{c as q,u as _,l as X,r as u,j as e,N as $,U as g,M as G,f as j,n as c,i as d}from"./index-WRKZqFJu.js";import{u as U}from"./useQuery-CmTz_4hp.js";import{u as F}from"./useMutation-xQinCMVx.js";import{S as O}from"./shield-Chs3YES7.js";import{S as V}from"./search-DV5nN8pN.js";import{C as L,a as P}from"./clock-BrhMVEe4.js";import{M as K}from"./mail-Dwmw0W6c.js";import{P as B}from"./phone-DtVpd4zN.js";import"./utils-D1gLOp5h.js";const H=q("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),T=q("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),ne=()=>{var A,S,k,C,M;const{user:a}=_(),x=X(),[o,D]=u.useState(""),[m,z]=u.useState(""),[i,I]=u.useState(""),{data:l,isLoading:E,error:y}=U({queryKey:["users"],queryFn:async()=>(await d.get("/auth/users?limit=100")).data.data,enabled:!!((A=a==null?void 0:a.permissions)!=null&&A.canManageUsers)}),{data:v}=U({queryKey:["pending-users"],queryFn:async()=>(await d.get("/auth/pending-users")).data.data,enabled:!!((S=a==null?void 0:a.permissions)!=null&&S.canManageUsers)}),r=Array.isArray(v)?v:[],p=F({mutationFn:async s=>(await d.put(`/auth/approve-user/${s}`)).data,onSuccess:()=>{x.invalidateQueries(["users"]),x.invalidateQueries(["pending-users"]),c.success("User approved successfully")},onError:s=>{var t,n;c.error(((n=(t=s.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to approve user")}}),N=F({mutationFn:async({userId:s,updates:t})=>(await d.put(`/auth/users/${s}`,t)).data,onSuccess:()=>{x.invalidateQueries(["users"]),c.success("User updated successfully")},onError:s=>{var t,n;c.error(((n=(t=s.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to update user")}}),f=Array.isArray(l==null?void 0:l.users)?l.users:[],h=f.filter(s=>{const t=s.name.toLowerCase().includes(o.toLowerCase())||s.email.toLowerCase().includes(o.toLowerCase()),n=m===""||s.role===m,R=i===""||i==="approved"&&s.isApproved||i==="pending"&&!s.isApproved||i==="active"&&s.isActive||i==="inactive"&&!s.isActive;return t&&n&&R}),b=s=>({SuperAdmin:"bg-red-100 text-red-800",Admin:"bg-purple-100 text-purple-800",ATI:"bg-blue-100 text-blue-800",NGO:"bg-green-100 text-green-800",Volunteer:"bg-yellow-100 text-yellow-800"})[s]||"bg-gray-100 text-gray-800",w=s=>{p.mutate(s)},Q=(s,t)=>{N.mutate({userId:s,updates:{isActive:!t}})};return(k=a==null?void 0:a.permissions)!=null&&k.canManageUsers?E?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading users..."})]}):y?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(T,{className:"mx-auto h-12 w-12 text-red-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Error loading users"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:((M=(C=y.response)==null?void 0:C.data)==null?void 0:M.message)||"Failed to fetch user data"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx($,{size:"md",showText:!1}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"NDMA User Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage user accounts and permissions"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Total Users: ",f.length]}),(r==null?void 0:r.length)>0&&e.jsxs("span",{className:"bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-sm",children:[r.length," Pending"]})]})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow border border-gray-200",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search users by name or email...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:o,onChange:s=>D(s.target.value)})]})}),e.jsxs("select",{value:m,onChange:s=>z(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Roles"}),e.jsx("option",{value:"SuperAdmin",children:"SuperAdmin"}),e.jsx("option",{value:"Admin",children:"Admin"}),e.jsx("option",{value:"ATI",children:"ATI"}),e.jsx("option",{value:"NGO",children:"NGO"}),e.jsx("option",{value:"Volunteer",children:"Volunteer"})]}),e.jsxs("select",{value:i,onChange:s=>I(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"pending",children:"Pending Approval"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})}),(r==null?void 0:r.length)>0&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-orange-800 mb-4 flex items-center",children:[e.jsx(L,{className:"w-5 h-5 mr-2"}),"Pending Approvals (",r.length,")"]}),e.jsx("div",{className:"grid gap-4",children:r.map(s=>e.jsx("div",{className:"bg-white p-4 rounded-lg border border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(g,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.email}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${b(s.role)}`,children:s.role}),s.state&&e.jsxs("span",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx(G,{className:"w-3 h-3 mr-1"}),s.state]})]})]})]}),e.jsxs("button",{onClick:()=>w(s._id),disabled:p.isPending,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:opacity-50 flex items-center space-x-2",children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{children:"Approve"})]})]})},s._id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["All Users (",h.length,")"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Location"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(g,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center",children:[e.jsx(K,{className:"w-3 h-3 mr-1"}),s.email]}),s.phone&&e.jsxs("div",{className:"text-sm text-gray-500 flex items-center",children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),s.phone]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${b(s.role)}`,children:s.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.state||"Not specified"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[s.isApproved?e.jsxs("span",{className:"flex items-center text-xs text-green-600",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Approved"]}):e.jsxs("span",{className:"flex items-center text-xs text-orange-600",children:[e.jsx(L,{className:"w-3 h-3 mr-1"}),"Pending"]}),s.isActive?e.jsxs("span",{className:"flex items-center text-xs text-green-600",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Active"]}):e.jsxs("span",{className:"flex items-center text-xs text-red-600",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),"Inactive"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[!s.isApproved&&e.jsx("button",{onClick:()=>w(s._id),disabled:p.isPending,className:"text-green-600 hover:text-green-900",title:"Approve User",children:e.jsx(j,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Q(s._id,s.isActive),disabled:N.isPending,className:s.isActive?"text-red-600 hover:text-red-900":"text-green-600 hover:text-green-900",title:s.isActive?"Deactivate User":"Activate User",children:s.isActive?e.jsx(H,{className:"w-4 h-4"}):e.jsx(j,{className:"w-4 h-4"})})]})})]},s._id))})]})}),h.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(g,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No users found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Try adjusting your search or filter criteria."})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(O,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"You don't have permission to manage users."})]})};export{ne as default};
