import{c,k as U,a as V,u as H,l as K,r as P,j as e,N as Z,C as G,M as J,U as W,z as n,i as g}from"./index-WRKZqFJu.js";import{f as X}from"./formatters-C68TFZxE.js";import{u as Y}from"./useQuery-CmTz_4hp.js";import{u as T}from"./useMutation-xQinCMVx.js";import{f as A}from"./index-PcI1xVBZ.js";import{B as ee}from"./building-E6-4-jOP.js";import"./utils-D1gLOp5h.js";const se=c("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),ae=c("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),D=c("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),te=c("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),re=async l=>{const d="https://ndma-training-server.onrender.com/api",{data:r}=await g.get(`${d}/trainings/${l}`);return r.data},ue=()=>{var f,v,y,N,w,k,z,C,S,F,M;const{id:l}=U(),d=V(),{user:r,isAuthenticated:b}=H(),L=K(),[q,o]=P.useState(!1),[m,x]=P.useState({rating:5,comment:""}),{data:s,isLoading:E,error:R}=Y({queryKey:["training",l],queryFn:()=>re(l)}),u=T({mutationFn:a=>g.post(`/trainings/${l}/feedback`,a),onSuccess:()=>{L.invalidateQueries(["training",l]),n.success("Feedback submitted successfully!"),o(!1),x({rating:5,comment:""})},onError:a=>{var t,i;n.error(((i=(t=a.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to submit feedback")}}),_=T({mutationFn:()=>g.delete(`/trainings/${l}`),onSuccess:()=>{n.success("Training deleted successfully!"),d("/trainings")},onError:a=>{var t,i;n.error(((i=(t=a.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to delete training")}}),$=a=>{if(a.preventDefault(),!b){n.error("Please login to submit feedback");return}u.mutate(m)},B=()=>{window.confirm("Are you sure you want to delete this training?")&&_.mutate()},p=r&&(r.role==="Admin"||((f=s==null?void 0:s.organizer)==null?void 0:f._id)===r.id),j=r&&(r.role==="Admin"||((v=s==null?void 0:s.organizer)==null?void 0:v._id)===r.id),I=(y=s==null?void 0:s.feedback)==null?void 0:y.some(a=>a.user._id===(r==null?void 0:r.id)),O=((N=s==null?void 0:s.feedback)==null?void 0:N.length)>0?s.feedback.reduce((a,t)=>a+t.rating,0)/s.feedback.length:0;if(E)return e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(R)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-red-600 mb-4",children:"Training not found"}),e.jsx("button",{onClick:()=>d("/trainings"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Back to Trainings"})]});const Q=a=>{switch(a){case"Scheduled":return"bg-blue-100 text-blue-800";case"Ongoing":return"bg-green-100 text-green-800";case"Completed":return"bg-gray-100 text-gray-800";case"Cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between mb-6",children:[e.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[e.jsx(Z,{size:"md",showText:!1}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:s.title}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${Q(s.status)}`,children:s.status}),e.jsx("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:s.theme})]})]})]}),(p||j)&&e.jsxs("div",{className:"flex gap-2 mt-4 md:mt-0",children:[p&&e.jsxs("button",{className:"flex items-center bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(ae,{className:"mr-2",size:16}),"Edit"]}),j&&e.jsxs("button",{onClick:B,className:"flex items-center bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700",children:[e.jsx(te,{className:"mr-2",size:16}),"Delete"]})]})]}),e.jsx("p",{className:"text-gray-700 text-lg leading-relaxed",children:s.description})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Training Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"mr-3 text-blue-600",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Date & Time"}),e.jsx("div",{className:"text-gray-600",children:A(new Date(s.date),"PPP p")})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(J,{className:"mr-3 text-red-600",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Location"}),e.jsxs("div",{className:"text-gray-600",children:[s.location.name&&e.jsx("div",{children:s.location.name}),s.location.address&&e.jsx("div",{children:s.location.address})]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{className:"mr-3 text-green-600",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Participants"}),e.jsxs("div",{className:"text-gray-600",children:[X(s.participants)," people"]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"mr-3 text-purple-600",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Institution"}),e.jsx("div",{className:"text-gray-600",children:s.institution})]})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Organizer"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:(w=s.organizer)==null?void 0:w.name}),e.jsx("div",{className:"text-gray-600",children:(k=s.organizer)==null?void 0:k.email})]}),((z=s.organizer)==null?void 0:z.organization)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Organization"}),e.jsx("div",{className:"text-gray-700",children:s.organizer.organization})]}),e.jsx("div",{children:e.jsx("span",{className:"bg-gray-100 text-gray-800 px-2 py-1 rounded text-sm",children:(C=s.organizer)==null?void 0:C.role})})]})]})]}),s.resources&&s.resources.length>0&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Resources"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:s.resources.map((a,t)=>e.jsxs("div",{className:"border border-gray-200 p-4 rounded-lg",children:[e.jsx("div",{className:"font-medium",children:a.name}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:a.type}),e.jsx("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-700",children:"View Resource"})]},t))})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Feedback & Reviews"}),((S=s.feedback)==null?void 0:S.length)>0&&e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx(D,{className:"text-yellow-500 mr-1",size:16}),e.jsx("span",{className:"font-medium",children:O.toFixed(1)}),e.jsxs("span",{className:"text-gray-600 ml-2",children:["(",s.feedback.length," reviews)"]})]})]}),b&&s.status==="Completed"&&!I&&e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(se,{className:"mr-2",size:16}),"Add Feedback"]})]}),q&&e.jsxs("form",{onSubmit:$,autoComplete:"off",className:"mb-6 p-4 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rating"}),e.jsx("select",{value:m.rating,onChange:a=>x(t=>({...t,rating:parseInt(a.target.value)})),autoComplete:"off",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[5,4,3,2,1].map(a=>e.jsxs("option",{value:a,children:[a," Star",a>1?"s":""]},a))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comment"}),e.jsx("textarea",{value:m.comment,onChange:a=>x(t=>({...t,comment:a.target.value})),autoComplete:"off",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"Share your experience..."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",disabled:u.isLoading,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-400",children:u.isLoading?"Submitting...":"Submit Feedback"}),e.jsx("button",{type:"button",onClick:()=>o(!1),className:"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:"Cancel"})]})]}),e.jsx("div",{className:"space-y-4",children:(F=s.feedback)==null?void 0:F.map((a,t)=>{var i;return e.jsxs("div",{className:"border-b border-gray-200 pb-4 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:(i=a.user)==null?void 0:i.name}),e.jsx("div",{className:"flex items-center",children:[...Array(5)].map((ie,h)=>e.jsx(D,{size:16,className:h<a.rating?"text-yellow-500":"text-gray-300",fill:h<a.rating?"currentColor":"none"},h))})]}),a.comment&&e.jsx("p",{className:"text-gray-700",children:a.comment}),e.jsx("div",{className:"text-sm text-gray-500 mt-2",children:A(new Date(a.createdAt),"PPp")})]},t)})}),((M=s.feedback)==null?void 0:M.length)===0&&e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No feedback yet. Be the first to share your experience!"})]})]})};export{ue as default};
